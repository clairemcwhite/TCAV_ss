# TCAV + ESM2 Pipeline Configuration
# Core 8 features: config-driven layers, random CAVs, thresholding, versioning

# Model Configuration
model:
  name: "esm2_t6_8M_UR50D"  # Start with smallest model
  registry_path: "models/model_registry.yaml"
  device: "cuda"  # Auto-falls back to CPU if unavailable
  
# Data Configuration
data:
  pos_jsonl: "znf_pos_100.jsonl"
  neg_jsonl: "neg_100.jsonl"
  window_length: 41
  train_test_split: 0.8  # 80/20 for held-out evaluation
  random_seed: 42
  
# Embedding Configuration
embedding:
  batch_size: 8
  output_dir: "outputs/embeddings"
  # Indexing guardrails (Core feature #2)
  validate_bos_offset: true
  log_corrections: true
  corrections_log: "outputs/logs/indexing_corrections.jsonl"
  
# CAV Training Configuration
cav:
  use_pca: false
  pca_dim: 128
  cv_folds: 5
  regularization_C: 1.0
  output_dir: "outputs/cavs"
  
  # Random CAVs specification (Core feature #4)
  n_random_cavs: 20
  random_mode: "label_shuffle"  # Options: label_shuffle, feature_permute, gaussian_noise
  random_seed_base: 42
  
  # Versioned artifacts (Core feature #7)
  artifact_version: "v1"
  save_manifest: true
  
# Evaluation Configuration
evaluation:
  output_dir: "outputs/evaluations"
  
  # Localization settings (trimmed for data efficiency)
  localization:
    top_k_windows: 1  # Save only top-1 per sample (not top-3/5)
    save_heatmaps:
      top_iou: 5      # Best localizations
      bottom_iou: 5   # Worst localizations
      random: 3       # Random samples
  
  # Thresholding (Core feature #3)
  thresholding:
    method: "f1_max"  # Options: f1_max, precision_at_recall_90, fpr_0.05
    save_path: "outputs/evaluations/thresholds.json"
  
  # Statistical testing
  random_cav_comparison:
    alpha: 0.05
    save_plot: true
    
# Detection Configuration
detection:
  output_dir: "outputs/detections"
  thresholds_path: "outputs/evaluations/thresholds.json"
  
  # Confidence levels (z-score based)
  confidence_levels:
    high: 3.0
    medium: 2.0
    low: 1.0
    
  # Ensemble settings
  ensemble_layers: true
  ensemble_method: "mean_z_score"  # or "max", "voting"

# Logging Configuration
logging:
  log_dir: "outputs/logs"
  log_level: "INFO"
  log_format: "%(asctime)s - %(name)s - %(levelname)s - %(message)s"

# Compute Configuration (HPC)
compute:
  num_workers: 4
  pin_memory: true
  mixed_precision: false  # Enable for larger models (t33_650M)

